---
title: "Ferramentas de Apoio √† Economia"
subtitle: "Aula 5 - Introdu√ß√£o ao R para Economistas"
author: "Tiago Afonso"
date: "2025-03"
format: markdown
---

# Instala√ß√£o do R

**Como instalar o R?**

Para instalar e poder utiliza o `R`, siga os seguintes passos:

1. Download R

  - Aceder ao site oficial do R: [https://cran.r-project.org/](https://cran.r-project.org/)
  - Escolher o sistema operativo adequado (Windows, Mac, Linux).
  -  Descarregar o ficheiro de instala√ß√£o e seguir as instru√ß√µes.

2. Download RStudio

  - Aceder ao site oficial do RStudio: [https://posit.co/download/rstudio-desktop/](https://posit.co/download/rstudio-desktop/)
  - Escolher a vers√£o gratuita (RStudio Desktop).
  - Descarregar o ficheiro de instala√ß√£o e seguir as instru√ß√µes.

3. (opcional) em alternativa ao RStudio, √© poss√≠vel utilizar uma nova inerface do R chamada Positron.

 - Aceder ao site oficial do Positron: [https://positron.posit.co/](https://positron.posit.co/)
  - Escolher o sistema operativo adequado (Windows, Mac, Linux).
  -  Descarregar o ficheiro de instala√ß√£o e seguir as instru√ß√µes.

Porque √© necess√°rio instalar o R e o RStudio? O `R` √© uma linguagem de programa√ß√£o e ambiente de software para an√°lise de dados. O `RStudio` e `positron` s√£o uma interface gr√°fica que facilita a utiliza√ß√£o do `R` e a visualiza√ß√£o dos resultados. O `R` √© uma das linguagens mais populares para an√°lise de dados econ√≥micos. Tem uma vasta comunidade de utilizadores e uma grande quantidade de pacotes dispon√≠veis, quer seja para a estima√ß√£o de modelos econom√©tricos, quer seja para a visualiza√ß√£o de dados.

---

# Primeiros Passos no R

**Ambiente de Trabalho:**
O Rstudio √© composto por 4 paineis principais:

- Ambiente: onde √© poss√≠vel ver os objetos carregados (conjuntos de dadaos e valores)
- Consola R: onde √© poss√≠vel escrever e executar comandos.
- R Script: onde √© poss√≠vel escrever e guardar scripts de c√≥digo.
- Output: onde √© poss√≠vel ver os resultados (gr√°ficos e p√°ginas).


## 1¬∫ passo - Limpar o ambiente de trabalho

Antes de iniciar qualquer projeto/an√°lise, √© importante limpar o ambiente do `R`. Desta forma, evitamos conflitos entre vari√°veis e fun√ß√µes de pprojetos antriores.

Para limpar todas as vari√°veis do ambiente de trabalho, utilizamos a fun√ß√£o `rm` com o argumento `list=ls()`.

```{r}
# limpar ambiente
rm(list = ls())
```

### Executar c√≥digo: Consola vs Script

O comando anterior pode ser inserido na consola do `R` ou no script de c√≥digo. Para criar um script de c√≥digo, basta clicar em `File > New File > R Script`. Para executar o c√≥digo, basta selecionar o c√≥digo (ou colocar o cursor na linhas) e clicar nas teclas `ctrl + enter`. Na consola basta apenas escrever o c√≥digo e clicar em `enter`. A vantagem do script √© que podemos guardar o c√≥digo e reutiliz√°-lo mais tarde. Quase como um documento de texto. Na maioria das vezes √© utilizado o script, normalmente a consola serve apenas para comando tempor√°rios (exemplo: apagar um objeto do ambiente criado por engano). 


## Opera√ß√µes Matem√°ticas

O `R` √© uma linguagem de programa√ß√£o que permite realizar opera√ß√µes matem√°ticas simples como adi√ß√£o, subtra√ß√£o, multiplica√ß√£o e divis√£o, como uma calculadora.

```{r}
# opera√ß√µes matem√°ticas
2 + 2 # ctrl + enter para executar
```

## Atribuir Valores a Objetos

Podemos atribuir valores a objetos e visualizar esses valores. Basta utilizar o operador `<-`. √â poss√≠vel tamb√©m utilizar o operador `->` para atribuir valores a objetos, √© necess√°rio colocar o objeto √† direita do operador.

```{r}
# atribuir valores a objetos
a <- 2
a # ver valor objeto

6 -> b # atribuir valor a objeto
```

Esstes objetos (`a`, `b` e `c`) s√£o armazenados no ambiente e podem ser utilizados em opera√ß√µes futuras.

```{r}
c <- a + b
```	

## Remover Objetos espec√≠ficos do Ambiente `R`

Para remover um ou mais objetos espec√≠ficos do ambiente.

```{r}
# remover objeto a
rm(a)

# remover lista de objetos b e c
rm(b, c)
```

## Exemplos de Opera√ß√µes

Alguns exemplos de opera√ß√µes matem√°ticas e fun√ß√µes em R.

```{r}
# exemplos
a <- 3
b <- 5
c <- 9
d <- (a + b) / c
e <- b^2 #quadrado
f <- sqrt(c) #raiz quadrada
h <- log(b) # logaritmo natural
i <- log(b, 10) # logaritmo base 10
```

## Fun√ß√µes B√°sicas

Uma fun√ß√£o √© um bloco de c√≥digo que executa uma tarefa espec√≠fica. O `R` possui v√°rias fun√ß√µes incorporadas que podem ser utilizadas para realizar tarefas espec√≠ficas. No exemplo acima foi utilizada a fun√ß√£o `sqrft` para calcular a raiz quadrada de um n√∫mero e a fun√ß√£o `log` para calcular o logaritmo de um n√∫mero.

Para ver a documenta√ß√£o de uma fun√ß√£o, onde est√° a sint√°xe, basta utilizar o operador `?` seguido do nome da fun√ß√£o.

```{r}
#| eval: false 
# help
?log
```

Vai aparecer, no canto superior direito do RStudio e do positron, a documenta√ß√£o da fun√ß√£o `log`. Na nova janela que aparece, podemos ver os argumentos da fun√ß√£o, a descri√ß√£o e exemplos de utiliza√ß√£o. Neste caso a fun√ß√£o `log` tem dois argumentos, `x` e `base`. O argumento `x` √© o n√∫mero para o qual queremos calcular o logaritmo e o argumento `base` √© a base do logaritmo. Se n√£o especificarmos a base, o logaritmo √© calculado na base `e` (logaritmo natural). 

Os argumentos de qualquer fun√ß√£o s√£o separados por v√≠rgulas. Se os argumentos s√£o opcionais, s√£o indicados entre par√™nteses retos `[]`. A ordem dos argumentos √© importante. Se n√£o soubermos a ordem dos argumentos, podemos ver a documenta√ß√£o da fun√ß√£o. √â possivel alterar a ordem dos argumentos, mas √© necess√°rio indicar o nome do argumento. por exemplo:

```{r}
# logaritmo base 10 - ordem normal
log(100, 10)
```

ou 

```{r}
# logaritmo base 10 - ordem alterada
log(base = 10, x = 100)
```

O resultado √© o mesmo.
## Objetos do `R`

O R tem v√°rios tipos de objetos, como vetores, matrizes, data frames, listas, etc. Os vetores s√£o uma sequ√™ncia de elementos de um mesmo tipo. Podem ser criados com a fun√ß√£o `c()`. OS objetos podem conter diferentes tipos de dados, como n√∫meros, texto, l√≥gicos, etc. Os objetos podem ser armazenados no ambiente de trabalho e utilizados em opera√ß√µes futuras. Seguem alguns exemplos de objetos do `R`:

| Tipo de Objeto | Descri√ß√£o                                                                 |
|----------------|---------------------------------------------------------------------------|
| Vetor          | Sequ√™ncia de elementos do mesmo tipo. Criado com a fun√ß√£o `c()`.          |
| Matriz         | Cole√ß√£o bidimensional de elementos do mesmo tipo. Criada com a fun√ß√£o `matrix()`. |
| Data Frame     | Tabela bidimensional onde cada coluna pode conter diferentes tipos de dados. Criado com a fun√ß√£o `data.frame()`. |
| Lista          | Cole√ß√£o de elementos de diferentes tipos. Criada com a fun√ß√£o `list()`.   |
| Fator          | Vari√°vel categ√≥rica com n√≠veis. Criado com a fun√ß√£o `factor()`.           |
| Array          | Cole√ß√£o multidimensional de elementos do mesmo tipo. Criado com a fun√ß√£o `array()`. |
| Valor          | Um √∫nico valor num√©rico ou de texto.    

## Fun√ß√µes b√°sicas do R Base mais Utilizadas 

O `R` possui v√°rias fun√ß√µes incorporadas que podem ser utilizadas para realizar tarefas espec√≠ficas. Seguem algumas fun√ß√µes b√°sicas mais utilizadas:

| Fun√ß√£o   | Descri√ß√£o                                                                 |
|----------|---------------------------------------------------------------------------|
| `mean`   | Calcula a m√©dia de um vetor ou coluna de dados                            |
| `sum`    | Calcula a soma dos elementos de um vetor                                  |
| `sd`     | Calcula o desvio padr√£o de um vetor                                       |
| `var`    | Calcula a vari√¢ncia de um vetor                                           |
| `min`    | Retorna o valor m√≠nimo de um vetor                                        |
| `max`    | Retorna o valor m√°ximo de um vetor                                        |
| `length` | Retorna o n√∫mero de elementos em um vetor                                 |
| `sort`   | Ordena os elementos de um vetor                                           |
| `table`  | Cria uma tabela de frequ√™ncias para os elementos de um vetor              |
| `summary`| Fornece um resumo estat√≠stico b√°sico (m√≠nimo, 1¬∫ quartil, mediana, m√©dia, 3¬∫ quartil, m√°ximo) de um vetor ou coluna de dados |

---

# Bibliotecas no R

As bibliotecas s√£o conjuntos de fun√ß√µes e dados que estendem a funcionalidade do `R`. O `R` possui um vasto reposit√≥rio de bibliotecas dispon√≠veis para diferentes tarefas. Para instalar uma biblioteca, utilizamos a fun√ß√£o `install.packages("nome_da_biblioteca")`. Para carregar uma biblioteca, utilizamos a fun√ß√£o `library(nome_da_biblioteca)`. Para instalar √© necess√°rio utilizar aspas duplas `""`, para carregar a biblioteca n√£o √© necess√°rio. Exemplo de como instalar a biblioteca `tidyverse`:

```{r}
#| eval: false
# instalar biblioteca tidyverse
install.packages("tidyverse")
```

Pode aparecer uma mensagem a perguntar se quer instalar as depend√™ncias. Responda `y` para sim. Para carregar a biblioteca `tidyverse` e ou uma nova janela para confirmar o mirror de instala√ß√£o. Escolha o mirror mais pr√≥ximo ou o gen√©rico (primeiro).

Exemplo para carregar a biblioteca `tidyverse`:

```{r}
#| warning: false
# carregar biblioteca tidyverse
library(tidyverse)
```

A biblioteca `tidyverse` √© uma cole√ß√£o de pacotes para ci√™ncia de dados. Inclui pacotes como `ggplot2`, `dplyr`, `tidyr`, `readr`, `purrr`, `tibble`, `stringr`, `forcats`, etc. A biblioteca `tidyverse` √© uma das bibliotecas mais populares para manipula√ß√£o de dados e visualiza√ß√£o de dados no `R`.

N√£o h√° qualquer problema carregar a biblioteca `tidyverse` v√°rias vezes. Se a biblioteca j√° estiver carregada, o `R` n√£o vai carregar novamente. Para remover a biblioteca do ambiente, utiliza-se a fun√ß√£o `detach("package:tidyverse")`. Isto pode ser √∫til para libertar algum espa√ßo na mem√≥ria do computador quando se trabalha com grandes conjuntos de dados e muitas bibliotecas. Para a an√°lise aqui aplicada n√£o dever√° ser um problema.

Se tentarmos carregar uma biblioteca que n√£o est√° instalada, o `R` vai dar um erro: `there is no package called 'nome_da_biblioteca'`. Para instalar a biblioteca, basta seguir os passos anteriores.

## Conflitos de fun√ß√µes

ao carregar uma biblioteca podem aparecer alguns conflitos de fun√ß√µes. Por exemplo ao carregar a bibliteca `dplyr` e a `base` do `R` pode aparecer um conflito com a fun√ß√£o `filter`. Para resolver este problema, podemos utilizar o nome da biblioteca seguido de `::` e o nome da fun√ß√£o. Por exemplo, para utilizar a fun√ß√£o `filter` da biblioteca `dplyr`, utilizamos `dplyr::filter`. 

## Consultar a documenta√ß√£o de uma fun√ß√£o

Para consultar a documenta√ß√£o de uma fun√ß√£o de uma biblioteca utiliza-se, por exemplo, `?dplyr::filter`. Isto vai abrir uma nova janela com a documenta√ß√£o da fun√ß√£o `filter` da biblioteca `dplyr`.

```{r}
#| eval: false
#| output: false
?dplyr::filter
```

---

# Introduzir dados para o ambiente `R`

## Vetores e Tabelas

Podemos introduzir dados "manualmente" ao criar vetores e convert√™-los em tabelas.

```{r}
# introduzir vetores (listas)
vetor1 <- c(1, 2, 3, 4)
vetor2 <- c(5, 6, 7, 8)
```	

Converter em tabela (conjuntos de vetores) com a fun√ß√£o `cbind` ou em data frame com a fun√ß√£o `data.frame`.

```{r}
# converter em tabela (conjuntos de vetores) - cbind
tabela1 <- cbind(vetor1, vetor2)
```

```{r}
# data frame -> conjunto de dados
df <- data.frame(vetor1, vetor2)
```


```{r}	
# ver dados
head(df) # ver as primeiras linhas, ou
View(df) # ver dados completos
```

## Importar Dados de ficheiros externos

### .csv

√â possivel importar dados externos para o ambiente do `R` utilizando a fun√ß√£o `read.csv()` para ficheiros `.csv` e `read_xlsx()` para ficheiros `.xlsx`. O `R` suporta muitos outros formatos de ficheiros, como `.txt`, `.dat`, `.dta`, `.sav`, etc. Pode ser necess√°rio utilizar fun√ß√µes bibliotecas adicionais para importar alguns formatos de ficheiros.

Exemplo para importar um ficheiro `.csv`:
```{r}
# limpar ambiente üßπ
rm(list = ls())

# importar um ficheiro .csv
dados_csv <- read.csv("CSV.csv")

head(dados_csv) # ver as primeiras linhas
tail(dados_csv) # ver as √∫ltimas linhas

View(dados_csv) # ver todos os dados
```

Na fun√ß√£o `read.csv()` √© necess√°rio indicar o caminho do ficheiro. Se o ficheiro estiver na mesma pasta que o script (ou paste diret√≥rio), basta indicar o nome do ficheiro. Se o ficheiro estiver numa pasta diferente, √© necess√°rio indicar o caminho completo do ficheiro. Por exemplo, `C:/Users/username/Documents/CSV.csv`.

```{r}
# ver pasta diret√≥rio
getwd()
```

Se o ficheiro a importar estiver na pasta diret√≥rio, basta indicar o nome do ficheiro. Se o ficheiro estiver numa pasta diferente, √© necess√°rio indicar o caminho completo do ficheiro. Por exemplo, `C:/Users/username/Documents/CSV.csv`.

### .xlsx

√â possivel ter v√°rios ficheiro de dados em simult√¢neo no ambiente do `R`. Contudo, **√© necess√°rio ter aten√ß√£o ao nomes dos objetos**. Se o nome for o mesmo, o R apenas **substitui o objeto** anterior pelo novo objeto sem qualquer avisa na consola. 


Para ver a sintaxe da fun√ß√£o, basta utilizar `?read.csv`. O `R`base n√£o suporta a importa√ß√£o de ficheiros `.xlsx`. Para importar ficheiros `.xlsx`, √© necess√°rio instalar e carregar a biblioteca `readxl`. Como no exemplo:

```{r}
# carregar biblioteca readxl
library(readxl)

#carregagar dados
dados_xlsx <- read_xlsx("EXCEL.xlsx")
```

Se n√£o estiver instalada, o `R` vai dar um erro: `there is no package called 'readxl'`. Para instalar a biblioteca, basta seguir os passos introduzir `install.packages("readxl")`.

Os dados s√£o importados para o ambiente do `R` como objetos do tipo `data frame`. Para obter uma descri√ß√£o dos dados, podemos utilizar a fun√ß√£o `summary()`.

```{r}
# estat√≠stica descritiva de um conjunto de dados
summary(dados_xlsx)
```

## Opera√ß√µes com colunas em data frames

Para realizar opera√ß√µes com colunas em data frames, basta utilizar o nome do data frame seguido do s√≠mbolo `$` e o nome da coluna. Por exemplo, para somar duas colunas `X1` e `X2` e guardar o resultado na coluna `Z`, basta utilizar a seguinte sintaxe:

```{r}
# estat√≠stica descritiva de uma vari√°vel num conjunto de dados
summary(dados_xlsx$Y)
```


Suponto agora que queremos somar duas colunas `X1` e `X2` e guardar o resultado na coluna `Z`, ou seja, $Z=X1+X2$, basta utilizar a seguinte sintaxe:

```{r}
# Z = X1 + X2
dados_xlsx$Z <- dados_xlsx$X1 + dados_xlsx$X2
head(dados_xlsx)
```

## Elimnar colunas em data frames
Para eliminar uma coluna dentro de um data frame, basta utilizar o operador `NULL`.

```{r}
# eliminar uma coluna dentro de um data frame
dados_xlsx$Z <- NULL
head(dados_xlsx)
```

Ao contr√°rio dos restantes objetos em que utilisamos `rm()` para eliminar. Netse caso `rm` seria utilizado para eliminar o data frame completo.

## Opera√ß√µes coim v√°rias colunas em data frames

Para realizar v√°rias opera√ß√µes com colunas em dita francs, podemos utilizar a sintaxe anterior. O que neste caso ficaria da seguinte forma:

```{r}
# calcular ln's de todas as vars

dados_xlsx$ln_y <- log(dados_xlsx$Y)
dados_xlsx$ln_x1 <- log(dados_xlsx$X1)
dados_xlsx$ln_x2 <- log(dados_xlsx$X2)
```

Aqui existe um excesso de repeti√ß√£o do nome do data frame. Para evitar este problema, podemos utilizar a fun√ß√£o `mutate` da biblioteca `dplyr`. A fun√ß√£o `mutate` permite adicionar novas colunas a um data frame. Para utilizar a fun√ß√£o `mutate`, √© necess√°rio carregar a biblioteca `dplyr`.

```{r}
# carregar biblioteca dplyr
library(dplyr)

dados_xlsx <- dados_xlsx |> 
  mutate(ln_y = log(Y),
         ln_x1 = log(X1),
         ln_x2 = log(X2))
```

Aqui foi utilizado o pipe `|>` para encadear as fun√ß√µes. O pipe `|>` √© um operador que permite encadear fun√ß√µes. O pipe operator significa "then" ou "ent√£o". O resultado da fun√ß√£o anterior √© passado como argumento para a pr√≥xima fun√ß√£o. O pipe `|>` √© muito √∫til para encadear v√°rias fun√ß√µes e fazer com que o c√≥digo seja mais leg√≠vel. O anterior pipe operator `%>%` foi substitu√≠do pelo pipe `|>`.

No bloco de c√≥digo anterior √© calculado o logaritmo natural de todas as vari√°veis e acrescetado ao data frame `dados_xlsx`. √â essa a raz√£o de estar duas vezes o nome do data frame. Se o c√≥digo fosse o seguinte:

```{r}
dados_xlsx_2 <- dados_xlsx |> 
  mutate(ln_y = log(Y),
         ln_x1 = log(X1),
         ln_x2 = log(X2))
```

era criado um novo data frame `dados_xlsx_2` com as novas vari√°veis e as do `data frame` original. O `data frame` mant√©m-se inalterado

---

# Aplica√ß√£o
Calcular o logartimo natural de todas as vari√°veis num√©ricas do data frame `ficheiro_dados1.xlsx`.

